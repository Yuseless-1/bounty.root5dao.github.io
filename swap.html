<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROOT5 Bridge - Root5DAO</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
        }

        /* Navigation - exact from root5dao.com */
        nav {
            background: #2a2a3e;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
            font-weight: 700;
            color: #fff;
            text-decoration: none;
        }

        .nav-logo img {
            width: 36px;
            height: 36px;
            border-radius: 8px;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: #e0e0e0;
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
            transition: color 0.2s;
        }

        .nav-links a:hover {
            color: #4ade80;
        }

        /* Main Content */
        .container {
            max-width: 550px;
            margin: 3rem auto;
            padding: 0 1.5rem;
        }

        h1 {
            text-align: center;
            margin-bottom: 2rem;
            font-size: 2.2rem;
            font-weight: 700;
        }

        .bridge-card {
            background: rgba(42, 42, 62, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .connect-btn, .bridge-btn {
            background: #4ade80;
            color: #1a1a2e;
            border: none;
            padding: 0.9rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
        }

        .connect-btn:hover, .bridge-btn:hover {
            background: #22c55e;
            transform: translateY(-1px);
        }

        .connect-btn:disabled, .bridge-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .wallet-info {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .wallet-info div {
            margin: 0.4rem 0;
        }

        .chain-selector {
            margin: 1.5rem 0;
        }

        .chain-selector label {
            display: block;
            margin-bottom: 0.6rem;
            font-weight: 600;
            font-size: 0.95rem;
            color: #e0e0e0;
        }

        .chain-select {
            width: 100%;
            padding: 0.9rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 0.95rem;
            cursor: pointer;
        }

        .chain-select option {
            background: #2a2a3e;
        }

        .swap-icon {
            text-align: center;
            margin: 1rem 0;
            font-size: 1.8rem;
            opacity: 0.7;
        }

        .amount-input-container {
            position: relative;
        }

        .amount-input {
            width: 100%;
            padding: 0.9rem;
            padding-right: 80px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 1.1rem;
        }

        .amount-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .max-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: #4ade80;
            border: none;
            padding: 0.5rem 0.9rem;
            border-radius: 6px;
            color: #1a1a2e;
            cursor: pointer;
            font-weight: 700;
            font-size: 0.8rem;
        }

        .max-btn:hover {
            background: #22c55e;
        }

        .balance-info {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        .balance-row {
            display: flex;
            justify-content: space-between;
            margin: 0.5rem 0;
        }

        .fee-info {
            background: rgba(74, 222, 128, 0.1);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border: 1px solid rgba(74, 222, 128, 0.3);
            font-size: 0.9rem;
        }

        .status-message {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .status-message.success {
            background: rgba(74, 222, 128, 0.2);
            border: 1px solid rgba(74, 222, 128, 0.4);
        }

        .status-message.error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
        }

        .status-message a {
            color: #4ade80;
            font-weight: 600;
        }

        /* Footer */
        footer {
            background: #2a2a3e;
            padding: 2rem;
            margin-top: 4rem;
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-content img {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .footer-links a {
            color: #e0e0e0;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .footer-links a:hover {
            color: #4ade80;
        }

        .footer-text {
            opacity: 0.6;
            margin-top: 1rem;
            font-size: 0.85rem;
            line-height: 1.6;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(26, 26, 46, 0.3);
            border-radius: 50%;
            border-top-color: #1a1a2e;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .container {
                margin: 2rem auto;
                padding: 0 1rem;
            }

            h1 {
                font-size: 1.8rem;
            }

            .bridge-card {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <a href="https://www.root5dao.com" class="nav-logo">
            <img src="https://www.root5dao.com/layers/pfp_base.png" alt="Root5DAO">
            <span>Root5DAO</span>
        </a>
        <ul class="nav-links">
            <li><a href="https://www.root5dao.com/">Home</a></li>
            <li><a href="https://www.root5dao.com/proposals">Proposals</a></li>
            <li><a href="https://www.root5dao.com/vote">Vote</a></li>
            <li><a href="https://www.root5dao.com/create">Create</a></li>
            <li><a href="https://www.root5dao.com/whitepaper">Whitepaper</a></li>
            <li><a href="https://merch.root5dao.com/">Merch</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <h1>üåâ ROOT5 Bridge</h1>
        
        <div class="bridge-card">
            <!-- Wallet Connection -->
            <div style="margin-bottom: 2rem;">
                <button id="connectBtn" class="connect-btn">Select Wallet</button>
                <div id="walletInfo" class="wallet-info" style="display: none;">
                    <div><strong>Connected:</strong> <span id="walletAddress"></span></div>
                    <div><strong>Network:</strong> <span id="currentNetwork"></span></div>
                </div>
            </div>

            <!-- Bridge Interface -->
            <div id="bridgeInterface" style="display: none;">
                <!-- Source Chain -->
                <div class="chain-selector">
                    <label>From Chain</label>
                    <select id="sourceChain" class="chain-select">
                        <option value="1">Ethereum</option>
                        <option value="8453">Base</option>
                        <option value="42161">Arbitrum</option>
                        <option value="56">BSC</option>
                    </select>
                </div>

                <div class="swap-icon">‚¨áÔ∏è</div>

                <!-- Destination Chain -->
                <div class="chain-selector">
                    <label>To Chain</label>
                    <select id="destChain" class="chain-select">
                        <option value="8453">Base</option>
                        <option value="42161">Arbitrum</option>
                        <option value="56">BSC</option>
                        <option value="1">Ethereum</option>
                    </select>
                </div>

                <!-- Amount Input -->
                <div class="chain-selector">
                    <label>Amount</label>
                    <div class="amount-input-container">
                        <input type="number" id="amountInput" class="amount-input" placeholder="0.0" min="0" step="0.000000001">
                        <button id="maxBtn" class="max-btn">MAX</button>
                    </div>
                </div>

                <!-- Balance Info -->
                <div class="balance-info">
                    <div class="balance-row">
                        <span>Your Balance:</span>
                        <span id="balance">Loading...</span>
                    </div>
                    <div class="balance-row">
                        <span>You will receive:</span>
                        <span id="receiveAmount">0 ROOT5</span>
                    </div>
                </div>

                <!-- Fee Info -->
                <div id="feeInfo" class="fee-info" style="display: none;">
                    <div class="balance-row">
                        <span>Bridge Fee:</span>
                        <span id="bridgeFee">~</span>
                    </div>
                    <div class="balance-row">
                        <span>Time:</span>
                        <span>5-10 minutes</span>
                    </div>
                </div>

                <!-- Bridge Button -->
                <button id="bridgeBtn" class="bridge-btn" disabled>Bridge Tokens</button>

                <!-- Status Message -->
                <div id="statusMessage" class="status-message" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <img src="https://www.root5dao.com/layers/pfp_base.png" alt="Root5DAO">
            <div class="footer-links">
                <a href="https://www.root5dao.com/">Home</a>
                <a href="https://www.root5dao.com/">About</a>
                <a href="https://www.root5dao.com/">Tokenomics</a>
                <a href="https://www.root5dao.com/">Docs</a>
                <a href="https://www.root5dao.com/">Contact</a>
            </div>
            <div><a href="https://merch.root5dao.com/">Shop Merch</a></div>
            <div class="footer-text">
                ¬© 2025 Root5DAO. All rights reserved.<br>
                Built on Solana ‚Ä¢ Powered by Community
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <script>
        window.addEventListener('load', initBridge);

        function initBridge() {
            if (typeof ethers === 'undefined') {
                alert('Loading issue. Please refresh.');
                return;
            }

            const CONTRACTS = {
                1: '0xC1b958dDf560AB592831b65dFC6a7f63b2EFe07E',
                8453: '0xb062C2505b5a9d80B5718845BdA75fa3c267ce0e',
                42161: '0xb062C2505b5a9d80B5718845BdA75fa3c267ce0e',
                56: '0xb062C2505b5a9d80B5718845BdA75fa3c267ce0e'
            };

            const CHAIN_NAMES = { 1: 'Ethereum', 8453: 'Base', 42161: 'Arbitrum', 56: 'BSC' };
            const EIDS = { 1: 30101, 8453: 30184, 42161: 30110, 56: 30102 };

            const ABI = [
                'function balanceOf(address) view returns (uint256)',
                'function quoteSend(tuple(uint32 dstEid, bytes32 to, uint256 amountLD, uint256 minAmountLD, bytes extraOptions, bytes composeMsg, bytes oftCmd) sendParam, bool payInLzToken) view returns (tuple(uint256 nativeFee, uint256 lzTokenFee))',
                'function send(tuple(uint32 dstEid, bytes32 to, uint256 amountLD, uint256 minAmountLD, bytes extraOptions, bytes composeMsg, bytes oftCmd) sendParam, tuple(uint256 nativeFee, uint256 lzTokenFee) fee, address refundAddress) payable returns (tuple(bytes32 guid, uint64 nonce))'
            ];

            let provider, signer, userAddress, currentChainId;

            document.getElementById('connectBtn').onclick = async () => {
                if (!window.ethereum) {
                    alert('Install MetaMask: https://metamask.io');
                    return;
                }

                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    provider = new ethers.BrowserProvider(window.ethereum);
                    signer = await provider.getSigner();
                    userAddress = await signer.getAddress();
                    currentChainId = Number((await provider.getNetwork()).chainId);

                    document.getElementById('walletAddress').textContent = userAddress.slice(0, 6) + '...' + userAddress.slice(-4);
                    document.getElementById('currentNetwork').textContent = CHAIN_NAMES[currentChainId] || 'Unknown';
                    document.getElementById('walletInfo').style.display = 'block';
                    document.getElementById('bridgeInterface').style.display = 'block';
                    document.getElementById('connectBtn').style.display = 'none';
                    document.getElementById('sourceChain').value = currentChainId;

                    updateBalance();
                    window.ethereum.on('accountsChanged', () => location.reload());
                    window.ethereum.on('chainChanged', () => location.reload());
                } catch (e) {
                    showStatus('Connection failed: ' + e.message, 'error');
                }
            };

            async function updateBalance() {
                try {
                    const chain = parseInt(document.getElementById('sourceChain').value);
                    if (chain !== currentChainId) {
                        document.getElementById('balance').textContent = 'Switch to ' + CHAIN_NAMES[chain];
                        return;
                    }
                    const contract = new ethers.Contract(CONTRACTS[chain], ABI, signer);
                    const bal = await contract.balanceOf(userAddress);
                    document.getElementById('balance').textContent = parseFloat(ethers.formatUnits(bal, 9)).toFixed(4) + ' ROOT5';
                    document.getElementById('bridgeBtn').disabled = !document.getElementById('amountInput').value;
                } catch (e) {
                    document.getElementById('balance').textContent = 'Error';
                }
            }

            document.getElementById('maxBtn').onclick = async () => {
                try {
                    const chain = parseInt(document.getElementById('sourceChain').value);
                    if (chain !== currentChainId) { switchNetwork(chain); return; }
                    const contract = new ethers.Contract(CONTRACTS[chain], ABI, signer);
                    const bal = await contract.balanceOf(userAddress);
                    document.getElementById('amountInput').value = ethers.formatUnits(bal, 9);
                    updateReceive();
                    quoteFee();
                } catch (e) {
                    showStatus('Error: ' + e.message, 'error');
                }
            };

            function updateReceive() {
                const amt = document.getElementById('amountInput').value;
                document.getElementById('receiveAmount').textContent = amt ? amt + ' ROOT5' : '0 ROOT5';
                document.getElementById('bridgeBtn').disabled = !amt || parseFloat(amt) <= 0;
            }

            document.getElementById('amountInput').oninput = () => { updateReceive(); quoteFee(); };

            async function quoteFee() {
                const amt = document.getElementById('amountInput').value;
                if (!amt || parseFloat(amt) <= 0) { document.getElementById('feeInfo').style.display = 'none'; return; }
                try {
                    const src = parseInt(document.getElementById('sourceChain').value);
                    const dst = parseInt(document.getElementById('destChain').value);
                    if (src !== currentChainId) return;
                    const contract = new ethers.Contract(CONTRACTS[src], ABI, signer);
                    const param = {
                        dstEid: EIDS[dst],
                        to: ethers.zeroPadValue(userAddress, 32),
                        amountLD: ethers.parseUnits(amt, 9),
                        minAmountLD: ethers.parseUnits(amt, 9),
                        extraOptions: '0x00030100110100000000000000000000000000030d40',
                        composeMsg: '0x',
                        oftCmd: '0x'
                    };
                    const quote = await contract.quoteSend(param, false);
                    document.getElementById('bridgeFee').textContent = '~' + parseFloat(ethers.formatEther(quote.nativeFee)).toFixed(6) + (CHAIN_NAMES[src] === 'BSC' ? ' BNB' : ' ETH');
                    document.getElementById('feeInfo').style.display = 'block';
                } catch (e) {}
            }

            async function switchNetwork(chainId) {
                const params = {
                    1: { chainId: '0x1' },
                    8453: { chainId: '0x2105', chainName: 'Base', rpcUrls: ['https://mainnet.base.org'], nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 }, blockExplorerUrls: ['https://basescan.org'] },
                    42161: { chainId: '0xa4b1', chainName: 'Arbitrum', rpcUrls: ['https://arb1.arbitrum.io/rpc'], nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 }, blockExplorerUrls: ['https://arbiscan.io'] },
                    56: { chainId: '0x38', chainName: 'BSC', rpcUrls: ['https://bsc-dataseed.binance.org'], nativeCurrency: { name: 'BNB', symbol: 'BNB', decimals: 18 }, blockExplorerUrls: ['https://bscscan.com'] }
                };
                try {
                    await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: params[chainId].chainId }] });
                } catch (e) {
                    if (e.code === 4902) await window.ethereum.request({ method: 'wallet_addEthereumChain', params: [params[chainId]] });
                }
            }

            document.getElementById('bridgeBtn').onclick = async () => {
                const src = parseInt(document.getElementById('sourceChain').value);
                const dst = parseInt(document.getElementById('destChain').value);
                const amt = document.getElementById('amountInput').value;

                if (src === dst) { showStatus('Different chains required', 'error'); return; }
                if (src !== currentChainId) { showStatus('Switch to ' + CHAIN_NAMES[src], 'error'); switchNetwork(src); return; }

                try {
                    document.getElementById('bridgeBtn').disabled = true;
                    document.getElementById('bridgeBtn').innerHTML = '<span class="loading"></span> Bridging...';

                    const contract = new ethers.Contract(CONTRACTS[src], ABI, signer);
                    const param = {
                        dstEid: EIDS[dst],
                        to: ethers.zeroPadValue(userAddress, 32),
                        amountLD: ethers.parseUnits(amt, 9),
                        minAmountLD: ethers.parseUnits(amt, 9),
                        extraOptions: '0x00030100110100000000000000000000000000030d40',
                        composeMsg: '0x',
                        oftCmd: '0x'
                    };
                    const quote = await contract.quoteSend(param, false);
                    const tx = await contract.send(param, { nativeFee: quote.nativeFee, lzTokenFee: 0 }, userAddress, { value: quote.nativeFee });

                    showStatus('Submitted! Confirming...', 'success');
                    await tx.wait();
                    showStatus('‚úÖ Success!<br><a href="https://layerzeroscan.com/tx/' + tx.hash + '" target="_blank">Track Here</a><br>Arriving in 5-10 min on ' + CHAIN_NAMES[dst], 'success');

                    document.getElementById('amountInput').value = '';
                    updateReceive();
                    updateBalance();
                } catch (e) {
                    showStatus('Failed: ' + (e.reason || e.message), 'error');
                } finally {
                    document.getElementById('bridgeBtn').disabled = false;
                    document.getElementById('bridgeBtn').textContent = 'Bridge Tokens';
                }
            };

            document.getElementById('sourceChain').onchange = updateBalance;
            document.getElementById('destChain').onchange = quoteFee;

            function showStatus(msg, type) {
                const el = document.getElementById('statusMessage');
                el.innerHTML = msg;
                el.className = 'status-message ' + type;
                el.style.display = 'block';
                if (type === 'success') setTimeout(() => el.style.display = 'none', 15000);
            }
        }
    </script>
</body>
</html>
